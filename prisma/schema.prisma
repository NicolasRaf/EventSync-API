generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(PARTICIPANT)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relação inversa: Um usuário pode organizar vários eventos
  events Event[]

  // Adicione esta linha: Inscrições que ele fez como participante

  registrations Registration[]

  // Amizades
  sentFriendRequests     Friendship[] @relation("Requester")
  receivedFriendRequests Friendship[] @relation("Addressee")

  sentMessages     Message[] @relation("Sender")
  receivedMessages Message[] @relation("Receiver")

  reviews Review[]

  @@map("users")
}

model Message {
  id        String   @id @default(uuid())
  content   String
  createdAt DateTime @default(now())

  senderId String
  sender   User   @relation("Sender", fields: [senderId], references: [id])

  receiverId String
  receiver   User   @relation("Receiver", fields: [receiverId], references: [id])

  @@map("messages")
}

model Event {
  id           String       @id @default(uuid())
  title        String
  description  String
  date         DateTime
  location     String?
  locationType LocationType @default(IN_PERSON)
  onlineUrl    String?

  // Relacionamento com User (Organizador)
  organizerId String
  organizer   User   @relation(fields: [organizerId], references: [id])

  overallRating Float?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Inscrições que ele fez como participante
  registrations Registration[]
  reviews       Review[]

  @@map("events")
}

model Registration {
  id   String   @id @default(uuid())
  date DateTime @default(now())

  // Adicione este campo novo:
  checkedInAt DateTime? // O ponto de interrogação diz que pode ser nulo (ainda não entrou)

  userId String
  user   User   @relation(fields: [userId], references: [id])

  eventId String
  event   Event  @relation(fields: [eventId], references: [id], onDelete: Cascade)
  status  String @default("PENDING") // PENDING, APPROVED, REJECTED

  @@unique([userId, eventId])
  @@map("registrations")
}

enum Role {
  ADMIN
  ORGANIZER
  PARTICIPANT
}

enum LocationType {
  ONLINE
  IN_PERSON
}

model Friendship {
  id          String   @id @default(uuid())
  requesterId String
  requester   User     @relation("Requester", fields: [requesterId], references: [id])
  addresseeId String
  addressee   User     @relation("Addressee", fields: [addresseeId], references: [id])
  status      String   @default("PENDING") // PENDING, ACCEPTED
  createdAt   DateTime @default(now())

  @@map("friendships")
}

model Review {
  id        String   @id @default(uuid())
  rating    Int
  comment   String?
  createdAt DateTime @default(now())

  eventId String
  event   Event  @relation(fields: [eventId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id])

  @@unique([userId, eventId])
  @@map("reviews")
}
